<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Wishlist Debugger</title>
<style>
  body { font-family: monospace; padding: 20px; background: #f0f0f0; }
  .debug-box { background: #333; color: #0f0; padding: 20px; white-space: pre-wrap; border-radius: 10px; margin-bottom: 20px; }
  h3 { margin-top: 0; color: #fff; }
  .card { background: white; padding: 10px; margin: 5px; display: inline-block; width: 150px; vertical-align: top; }
  img { width: 100%; height: 100px; object-fit: cover; background: #ccc; }
</style>
</head>
<body>

<h2>üõ†Ô∏è Wishlist Diagnostics</h2>
<p>Please take a screenshot of the black box below and send it to me.</p>

<div id="debugOutput" class="debug-box">Loading data from Google Sheet...</div>

<div id="visualCheck"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGE0vN4yxngAyqooJAnULrBQbbNc6kyluYSg7JgydWeJ5481HmsFxVgC8kCWBvE3Wq/exec";

async function runDiagnostics(){
  const debug = document.getElementById("debugOutput");
  const visual = document.getElementById("visualCheck");

  try {
    // 1. Fetch Data
    const res = await fetch(SCRIPT_URL + "?action=getProducts");
    const data = await res.json();
    
    if(!data.success || !data.products || data.products.length === 0){
      debug.textContent = "Error: No products found in the sheet.";
      return;
    }

    // 2. Get the first product to inspect column names
    const sampleProduct = data.products[0];
    
    // 3. Print ALL Column Names found
    const keys = Object.keys(sampleProduct);
    let report = "‚úÖ DATA RECEIVED FROM SHEET:\n\n";
    report += "Here are your exact Column Names:\n";
    report += "----------------------------------\n";
    keys.forEach(k => {
       report += `[${k}] : ${sampleProduct[k]}\n`;
    });
    
    debug.textContent = report;

    // 4. Try to render one card
    visual.innerHTML = "<h3>Visual Test:</h3>";
    data.products.slice(0,3).forEach(p => {
       // Attempt to find image
       let img = p["Image URL 1"] || p["Image"] || p["image"] || p["Photo"] || "";
       
       const div = document.createElement("div");
       div.className = "card";
       div.innerHTML = `
         <img src="${img}" onerror="this.src='https://via.placeholder.com/150?text=Broken'">
         <b>${p.Name || "No Name"}</b><br>
         <small>SKU: ${p.SKU}</small>
       `;
       visual.appendChild(div);
    });

  } catch(e) {
    debug.textContent = "CRITICAL ERROR:\n" + e.toString();
  }
}

runDiagnostics();
</script>

</body>
</html>
