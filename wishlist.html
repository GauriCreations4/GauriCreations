<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wishlist ‚Ä¢ Gauri Creations</title>
 <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="favicon.ico"> 

<style>
  :root{
    --bg-grad: linear-gradient(135deg,#e3f2ff,#ffe5f3);
    --glass: rgba(255,255,255,0.95);
    --glass-border: rgba(148,163,184,0.6);
    --accent-grad: linear-gradient(135deg,#2563eb,#ec4899);
  }

  * { box-sizing:border-box }

  body{
    margin:0;
    min-height:100vh;
    font-family:Poppins,system-ui;
    background:var(--bg-grad);
    padding:20px;
    display:flex;
    justify-content:center;
  }

  .shell{
    width:100%;
    max-width:1150px;
  }

  h2{
    font-size:24px;
    font-weight:800;
    margin-bottom:6px;
    text-align: center;
  }

  .sub{
    font-size:13px;
    color:#555;
    margin-bottom:25px;
    text-align: center;
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    gap:16px;
  }

  .card{
    background:var(--glass);
    border-radius:18px;
    border:1px solid var(--glass-border);
    box-shadow:0 12px 30px rgba(15,23,42,0.1);
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:8px;
    position: relative;
  }

  .img-wrap{
    border-radius:12px;
    overflow:hidden;
    height:160px;
    background:#f1f5f9;
    display:flex;
    align-items:center;
    justify-content:center;
    position: relative;
  }

  .img-wrap img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  /* Delete Button (Top Right) */
  .btn-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255,255,255,0.9);
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    z-index: 10;
  }

  .name{
    font-size:14px;
    font-weight:600;
    margin-top: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .price{
    font-weight:700;
    color:#2563eb;
    font-size:15px;
  }

  .actions{
    display:flex;
    gap:6px;
    margin-top:auto;
  }

  .btn{
    flex:1;
    padding:8px;
    border-radius:999px;
    font-size:12px;
    cursor:pointer;
    border:none;
    font-weight:600;
    text-align: center;
    text-decoration: none;
  }

  .btn-primary{
    background:var(--accent-grad);
    color:#fff;
  }

  .btn-outline{
    background:#fff;
    border:1px solid #ccc;
    color: #333;
  }

  .empty{
    text-align:center;
    padding:60px 20px;
    color:#555;
    grid-column: 1 / -1;
  }
  
  .loader {
    text-align: center;
    width: 100%;
    padding: 40px;
    font-weight: bold;
    color: #666;
    grid-column: 1 / -1;
  }
</style>
</head>

<body>

<div class="shell">
  <h2>‚ù§Ô∏è My Wishlist</h2>
  <div class="sub">Your saved favorites</div>

  <div id="grid" class="grid">
    <div class="loader">Loading your favorites...</div>
  </div>
</div>

<script>
// üî¥ Ensure this URL matches your deployed script
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGE0vN4yxngAyqooJAnULrBQbbNc6kyluYSg7JgydWeJ5481HmsFxVgC8kCWBvE3Wq/exec";

function getWishlist(){
  return JSON.parse(localStorage.getItem("gc_wishlist") || "[]");
}

function saveWishlist(list){
  localStorage.setItem("gc_wishlist", JSON.stringify(list));
}

function removeFromWishlist(sku){
  const list = getWishlist().filter(s => String(s) !== String(sku));
  saveWishlist(list);
  renderWishlist(); // Refresh UI
}

async function renderWishlist(){
  const grid = document.getElementById("grid");
  const wishlistIds = getWishlist();

  if(wishlistIds.length === 0){
    grid.innerHTML = `
      <div class="empty">
        <div style="font-size:40px;margin-bottom:10px">üíî</div>
        Your wishlist is empty.<br>
        <a href="store.html" style="color:#2563eb;font-weight:bold;margin-top:10px;display:inline-block">Browse Products</a>
      </div>`;
    return;
  }

  // 1. Fetch ALL products at once (Faster than loop)
  try{
    const res = await fetch(SCRIPT_URL + "?action=getProducts");
    const data = await res.json();
    
    if(!data.success){
       grid.innerHTML = "<div class='empty'>Error loading products.</div>";
       return;
    }

    // 2. Filter locally
    const myItems = data.products.filter(p => wishlistIds.includes(String(p["SKU"])));

    grid.innerHTML = ""; // Clear loader

    if(myItems.length === 0){
       // IDs exist in local storage but products were deleted from sheet
       grid.innerHTML = "<div class='empty'>Items no longer available.</div>";
       return;
    }

    // 3. Render
    myItems.forEach(p => {
      // ‚úÖ IMAGE FIX: Checks "Image URL 1" -> "Image" -> Placeholder
      const imgUrl = p["Image URL 1"] || p["Image"] || "https://via.placeholder.com/300?text=No+Image";

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <button class="btn-remove" onclick="removeFromWishlist('${p.SKU}')">‚úï</button>
        
        <div class="img-wrap">
          <img src="${imgUrl}" onerror="this.src='https://via.placeholder.com/300?text=Error'">
        </div>

        <div class="name">${p.Name}</div>
        <div class="price">‚Çπ${p.Price}</div>

        <div class="actions">
          <a class="btn btn-outline" href="product.html?sku=${encodeURIComponent(p.SKU)}">
            View
          </a>
          <a class="btn btn-primary" href="order.html?sku=${encodeURIComponent(p.SKU)}">
            Buy Now
          </a>
        </div>
      `;

      grid.appendChild(card);
    });

  }catch(e){
    console.error(e);
    grid.innerHTML = "<div class='empty'>Network error. Please refresh.</div>";
  }
}

// Start
renderWishlist();
</script>

</body>
</html>
