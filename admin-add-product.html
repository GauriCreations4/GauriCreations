<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Add Product ‚Ä¢ Gauri Creations</title>

<link rel="icon" href="favicon.ico" type="image/x-icon">

<style>
  :root {
    --bg-grad: linear-gradient(135deg, #86e1ff, #ffd4b8);
    --glass-bg: rgba(255, 255, 255, 0.18);
    --glass-border: rgba(255, 255, 255, 0.6);
    --shadow-strong: 0 22px 60px rgba(15, 23, 42, 0.40);
  }

  *{ box-sizing:border-box; }

  body {
    margin:0;
    min-height:100vh;
    font-family:Poppins, system-ui;
    background:var(--bg-grad);
    display:flex;
    justify-content:center;
    padding:18px;
  }

  .shell { width:100%; max-width:980px; }

  .card {
    border-radius:26px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    backdrop-filter:blur(22px);
    padding:18px;
    box-shadow:var(--shadow-strong);
  }

  .card-header {
    display:flex;
    justify-content:space-between;
    margin-bottom:16px;
  }

  .card-title { font-size:20px; font-weight:700; }
  .card-sub { font-size:12px; color:#555; }

  .pill-link {
  /* 1. Circle Shape & Glass Effect */
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.35); /* Translucent white */
  backdrop-filter: blur(12px);          /* Blur effect */
  -webkit-backdrop-filter: blur(12px);  /* Safari support */
  border: 1px solid rgba(255, 255, 255, 0.5);
  
  /* 2. Center the Icon */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  
  /* 3. Hide the text "‚Üê Back" so only the icon shows */
  font-size: 0; 
  text-decoration: none;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s, background 0.2s;
}

/* 4. Add the iOS Chevron Icon */
.pill-link::before {
  content: '';
  width: 10px;
  height: 18px;
  /* Dark Grey Arrow Icon */
  background-image: url("data:image/svg+xml,%3Csvg width='12' height='20' viewBox='0 0 12 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 2L2 10L10 18' stroke='%23333' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  transform: translateX(-1px); /* Optical centering */
}

/* 5. Hover & Click Effects */
.pill-link:hover {
  background: rgba(255, 255, 255, 0.6);
  transform: scale(1.05);
}

.pill-link:active {
  transform: scale(0.92);
}

  .layout {
    display:grid;
    grid-template-columns:1.3fr 1fr;
    gap:14px;
  }

  @media(max-width:900px){
    .layout{ grid-template-columns:1fr; }
  }

  .section-card {
    background:white;
    border-radius:20px;
    padding:14px;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
  }

  .section-title { font-size:14px; font-weight:600; margin-bottom:4px; }
  .section-sub { font-size:11px; color:#777; margin-bottom:10px; }

  label { font-size:12px; font-weight:600; margin-bottom:4px; display:block; }

  .input, .textarea{
    width:100%;
    padding:9px 12px;
    border-radius:12px;
    border:1px solid #ccc;
    background:#f5f5f5;
    font-size:13px;
  }

  .textarea{ resize:vertical; min-height:80px; }

  .field-row {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }

  @media(max-width:600px){
    .field-row{ grid-template-columns:1fr; }
  }

  .drop-zone {
    border:1.5px dashed #999;
    padding:14px;
    border-radius:16px;
    background:#fafafa;
    text-align:center;
    cursor:pointer;
    font-size:12px;
  }
  
  .drop-zone:hover {
    background:#eee;
  }

  .preview-grid {
    margin-top:10px;
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:8px;
  }

  .preview-card {
    position:relative;
    height:90px;
    border-radius:14px;
    overflow:hidden;
    background:#ddd;
  }

  .preview-card img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .remove-btn{
    position:absolute;
    top:4px; right:4px;
    background:#e11d48;
    color:white;
    border:none;
    border-radius:999px;
    padding:3px 7px;
    font-size:10px;
    cursor:pointer;
  }

  .video-chip{
    margin-top:8px;
    background:#def7ec;
    padding:6px 10px;
    border-radius:10px;
    font-size:11px;
    display:inline-flex;
    gap:6px;
  }

  .footer-row{
    margin-top:16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .btn-primary{
    background:linear-gradient(135deg,#2563eb,#ec4899);
    color:white;
    border:none;
    padding:12px 20px;
    border-radius:999px;
    font-size:14px;
    display:flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
  }

  .status-text{ font-size:12px; color:#777; }
  .status-text.ok{ color:#15803d; }
  .status-text.err{ color:#e11d48; }
</style>
</head>

<body>
<div class="shell">
<div class="card">

<div class="card-header">
  <div>
    <div class="card-title">Add New Product</div>
    <div class="card-sub">Upload images & details.</div>
  </div>
  <a href="admin.html" class="pill-link">‚Üê Back</a>
</div>

<div class="layout">
<section class="section-card">
<label>Product Name *</label>
<input id="name" class="input" type="text"/>

<div class="field-row">
  <div>
    <label>Price (‚Çπ) *</label>
    <input id="price" class="input" type="number"/>
  </div>
  <div>
    <label>Category *</label>
    <input id="category" class="input" type="text"/>
  </div>
</div>

<div class="field-row">
  <div>
    <label>Stock *</label>
    <input id="stock" class="input" type="number"/>
  </div>
  <div>
    <label>Weight</label>
    <input id="weight" class="input" type="text"/>
  </div>
</div>

<div class="field-row">
  <div><label>Length</label><input id="length" class="input" type="number"/></div>
  <div><label>Width</label><input id="width" class="input" type="number"/></div>
</div>

<div class="field-row">
  <div><label>Height</label><input id="height" class="input" type="number"/></div>
  <div><label>Video URL</label><input id="videoUrlInput" class="input" type="text" placeholder="Or upload video below"/></div>
</div>

<label>Description</label>
<textarea id="description" class="textarea"></textarea>
</section>

<section class="section-card">
<label>Images</label>
<div id="imageDropZone" class="drop-zone" onclick="document.getElementById('imageInput').click()">
  Click here to select images
</div>
<input id="imageInput" type="file" accept="image/*" multiple hidden>
<div id="imagePreview" class="preview-grid"></div>

<br>
<label>Video</label>
<div id="videoDropZone" class="drop-zone" onclick="document.getElementById('videoInput').click()">
  Click here to select video
</div>
<input id="videoInput" type="file" accept="video/*" hidden>
<div id="videoInfo" class="video-chip" style="display:none;">
üé¨ <span id="videoName"></span>
</div>
</section>
</div>

<div class="footer-row">
  <div id="statusText" class="status-text">Fill details and click Add Product.</div>
  <button id="saveBtn" class="btn-primary">‚ûï Add Product</button>
</div>

</div>
</div>

<script>
// Wait for page to fully load before running script
document.addEventListener('DOMContentLoaded', function() {
    
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGE0vN4yxngAyqooJAnULrBQbbNc6kyluYSg7JgydWeJ5481HmsFxVgC8kCWBvE3Wq/exec";
  
    // Global variables
    let imageFiles = [];
    let videoFile = null;

    // Element Selectors
    const qs = id => document.getElementById(id);
    const imageInput = qs("imageInput");
    const imagePreview = qs("imagePreview");
    const videoInput = qs("videoInput");
    const videoInfo = qs("videoInfo");
    const videoNameEl = qs("videoName");
    const statusText = qs("statusText");
    const saveBtn = qs("saveBtn");

    /* ================== 1. IMAGE HANDLING ================== */
    
    if(imageInput){
      imageInput.onchange = () => {
        const files = Array.from(imageInput.files);
        
        if (imageFiles.length + files.length > 5) {
          alert("Maximum 5 images allowed.");
          return;
        }
        
        files.forEach(file => {
          imageFiles.push(file);
          
          // Create preview
          const reader = new FileReader();
          reader.onload = (e) => {
            const div = document.createElement("div");
            div.className = "preview-card";
            div.innerHTML = `
              <img src="${e.target.result}">
              <button class="remove-btn" type="button">√ó</button>
            `;
            
            // Add remove logic
            div.querySelector(".remove-btn").onclick = function() {
              imageFiles = imageFiles.filter(f => f.name !== file.name);
              div.remove();
            };
            
            imagePreview.appendChild(div);
          };
          reader.readAsDataURL(file);
        });
        imageInput.value = ""; // Reset to allow re-selecting same file
      };
    }

    /* ================== 2. VIDEO HANDLING ================== */

    if(videoInput){
      videoInput.onchange = () => {
        if (videoInput.files[0]) {
          videoFile = videoInput.files[0];
          videoInfo.style.display = "inline-flex";
          videoNameEl.textContent = videoFile.name;
          qs("videoUrlInput").value = ""; 
          qs("videoUrlInput").disabled = true;
          qs("videoUrlInput").placeholder = "File selected: " + videoFile.name;
        }
      };
    }

    /* ================== 3. HELPER: CONVERT TO BASE64 ================== */

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    /* ================== 4. SUBMIT LOGIC ================== */

    if(saveBtn){
      saveBtn.onclick = async () => {
        // Validation
        if (!qs("name").value || !qs("price").value) {
          alert("Please fill in Product Name and Price.");
          return;
        }

        saveBtn.disabled = true;
        saveBtn.innerHTML = "‚è≥ Uploading Media...";
        statusText.textContent = "Please wait, uploading images...";
        statusText.className = "status-text";

        try {
          // A. Upload Images
          let uploadedImageUrls = [];
          for (const file of imageFiles) {
            const base64 = await toBase64(file);
            const res = await fetch(SCRIPT_URL, {
              method: "POST",
              body: JSON.stringify({ 
                action: "uploadMedia",
                fileName: file.name,
                mimeType: file.type,
                base64: base64
              })
            });
            const data = await res.json();
            if (data.success) uploadedImageUrls.push(data.url);
          }

          // B. Upload Video
          let finalVideoUrl = qs("videoUrlInput").value;
          if (videoFile) {
            statusText.textContent = "Uploading video (this may take time)...";
            const vBase64 = await toBase64(videoFile);
            const vRes = await fetch(SCRIPT_URL, {
              method: "POST",
              body: JSON.stringify({
                action: "uploadMedia",
                fileName: videoFile.name,
                mimeType: videoFile.type,
                base64: vBase64
              })
            });
            const vData = await vRes.json();
            if (vData.success) finalVideoUrl = vData.url;
          }

          // C. Save Product
          saveBtn.innerHTML = "‚è≥ Saving Product...";
          
          const productBody = {
            action: "createProduct",
            name: qs("name").value,
            price: qs("price").value,
            category: qs("category").value,
            stock: qs("stock").value,
            weight: qs("weight").value,
            length: qs("length").value,
            width: qs("width").value,
            height: qs("height").value,
            description: qs("description").value,
            videoUrl: finalVideoUrl,
            imageUrl1: uploadedImageUrls[0] || "",
            imageUrl2: uploadedImageUrls[1] || "",
            imageUrl3: uploadedImageUrls[2] || "",
            imageUrl4: uploadedImageUrls[3] || "",
            imageUrl5: uploadedImageUrls[4] || ""
          };

          const finalRes = await fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify(productBody)
          });

          const finalData = await finalRes.json();

          if (finalData.success) {
            statusText.textContent = "Product Saved Successfully! ‚úî";
            statusText.className = "status-text ok";
            setTimeout(resetForm, 2000);
          } else {
            throw new Error(finalData.message || "Unknown error");
          }

        } catch (err) {
          console.error(err);
          statusText.textContent = "Error: " + err.message;
          statusText.className = "status-text err";
          saveBtn.disabled = false;
          saveBtn.innerHTML = "‚ûï Add Product";
        }
      };
    }

    function resetForm(){
      ["name","price","category","stock","weight","length","width","height","description","videoUrlInput"]
      .forEach(id => qs(id).value = "");
      
      qs("videoUrlInput").disabled = false;
      qs("videoUrlInput").placeholder = "Or upload video below";
      
      imageFiles = [];
      imagePreview.innerHTML = "";
      imageInput.value = "";
      
      videoFile = null;
      videoInput.value = "";
      videoInfo.style.display = "none";
      videoNameEl.textContent = "";

      saveBtn.disabled = false;
      saveBtn.innerHTML = "‚ûï Add Product";
      statusText.textContent = "Fill details and click Add Product.";
      statusText.className = "status-text";
    }

});
</script>
</body>
</html>
